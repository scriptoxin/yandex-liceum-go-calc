# Распределенный вычислитель арифметических выражений

## Описание проекта

Этот проект представляет собой распределенную систему для вычисления арифметических выражений. Она состоит из двух основных компонентов:

- **Оркестратор** – управляет вычислениями, разбивает выражения на задачи и распределяет их между агентами.
- **Агент** – выполняет вычисления отдельных задач и возвращает результаты оркестратору.

## Архитектура

```
+-------------------+        +---------------------+
|  Клиент          |        |   Агент (Worker)    |
|  (Ввод данных)   |        |                     |
|------------------|        | - Запрашивает задачи |
| Отправляет      | -----> | - Вычисляет         |
| выражение       |        | - Возвращает результат |
+------------------+        +---------------------+
       |                           |
       v                           v
+------------------+        +----------------------+
|  Оркестратор    |        |  Несколько агентов   |
| (Распределитель)| <----> | (Параллельные процессы)|
|-----------------|        |                      |
| - Разбирает     |        +----------------------+
| - Делит задачи  |
| - Собирает результат |
+------------------+
```

## Принцип работы

1. **Клиент** отправляет арифметическое выражение (например, `2 + 2 * 2`).
2. **Оркестратор** разбивает выражение на задачи и назначает им уникальные ID.
3. **Агенты** запрашивают задачи, вычисляют и отправляют обратно.
4. **Оркестратор** собирает результаты и формирует окончательное вычисление.
5. **Клиент** запрашивает итоговый результат у оркестратора.

## API Оркестратора

- **Отправить выражение**: `POST /api/v1/calculate`
- **Получить список выражений**: `GET /api/v1/expressions`
- **Получить выражение по ID**: `GET /api/v1/expressions/:id`
- **Запросить задачу**: `GET /internal/task`
- **Отправить результат задачи**: `POST /internal/task`

## Установка

### Клонирование репозитория

```bash
git clone https://github.com/scriptoxin/yandex-liceum-go-calc.git
cd yandex-liceum-go-calc
```

### Настройка порта

Вы можете настроить порт через переменную окружения **PORT**. По умолчанию используется порт 8080. Пример для использования другого порта:

```bash
export PORT=8081
```

## Запуск системы

### Оркестратор

```sh
export TIME_ADDITION_MS=5000
export TIME_SUBTRACTION_MS=5000
export TIME_MULTIPLICATION_MS=5000
export TIME_DIVISION_MS=5000

go run cmd/calc_service/main.go
```

### Агент

```sh
export COMPUTING_POWER=4
export ORCHESTRATOR_URL=http://localhost:8080

go run cmd/agent/main.go
```

## Пример использования

1. **Отправить выражение**

```sh
curl --location 'http://localhost:8080/api/v1/calculate' --header 'Content-Type: application/json' --data '{ "expression": "2 + 2 * 2" }'
```

Ответ:

```json
{ "id": "12345" }
```

2. **Проверить результат**

```sh
curl --location 'http://localhost:8080/api/v1/expressions/12345'
```

Пример ответа:

```json
{
  "expression": {
    "id": "12345",
    "status": "pending",
    "result": null
  }
}
```

## Масштабируемость

- Запуск нескольких агентов увеличивает вычислительную мощность.
- Каждый агент запускает несколько горутин (настраивается через `COMPUTING_POWER`).
- Обработка задач происходит параллельно для максимальной эффективности.
